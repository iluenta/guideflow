# Gu√≠a de Testing - Sistema de Traducci√≥n con Cach√©
## Para Testing Manual (No requiere conocimientos de programaci√≥n)

---

## üìã CHECKLIST GENERAL

**Antes de empezar:**
- [ ] Antigravity confirma que el deploy en staging est√° completo
- [ ] Tienes acceso a:
  - [ ] Staging: https://staging.tuapp.com
  - [ ] Supabase SQL Editor
  - [ ] Logs de Vercel/tu plataforma
- [ ] Tienes a mano este checklist impreso o en otra pesta√±a

**Duraci√≥n estimada:** 3-4 horas

---

## üß™ TEST 1: Verificar Base de Datos (15 min)

### Objetivo
Confirmar que las tablas se crearon correctamente en Supabase.

### Pasos

**1.1. Abrir Supabase SQL Editor**
- Ir a: https://supabase.com/dashboard/project/TU_PROJECT/sql
- Copiar y ejecutar este query:

```sql
-- Verificar que las tablas existen
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('translation_cache', 'translation_metrics');
```

**‚úÖ Resultado esperado:**
```
translation_cache
translation_metrics
```

**‚ùå Si no aparecen:** Avisar a Antigravity que el SQL no se ejecut√≥.

---

**1.2. Verificar √≠ndices**

```sql
-- Verificar que los √≠ndices existen
SELECT indexname 
FROM pg_indexes 
WHERE tablename IN ('translation_cache', 'translation_metrics');
```

**‚úÖ Resultado esperado:** Debe mostrar al menos 4 √≠ndices:
```
idx_translation_hash
idx_translation_usage
idx_translation_langs
idx_translation_last_used
```

---

**1.3. Verificar funciones SQL**

```sql
-- Verificar que las funciones existen
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_name IN ('cleanup_translation_cache', 'get_translation_cache_stats');
```

**‚úÖ Resultado esperado:**
```
cleanup_translation_cache
get_translation_cache_stats
```

---

## üß™ TEST 2: Cache MISS - Primera Traducci√≥n (15 min)

### Objetivo
Verificar que la primera vez que se traduce algo, se guarda en la base de datos.

### Pasos

**2.1. Limpiar cach√© (empezar desde cero)**

En Supabase SQL Editor:
```sql
DELETE FROM translation_cache;
DELETE FROM translation_metrics;
```

**‚úÖ Confirmaci√≥n:** Debe decir "0 rows affected" o similar.

---

**2.2. Enviar mensaje en ingl√©s**

1. Abrir staging: https://staging.tuapp.com/villa-sol-mar (o tu property test)
2. **Cambiar idioma a ingl√©s** (selector de idioma)
3. Escribir en el chat: `"What is the WiFi password?"`
4. Enviar y esperar respuesta

**‚úÖ Debe responder en ingl√©s** (no espa√±ol)

---

**2.3. Revisar logs de Vercel**

1. Ir a: Vercel Dashboard ‚Üí tu proyecto ‚Üí Logs
2. Buscar l√≠neas recientes con `[TRANSLATION]`

**‚úÖ Resultado esperado:**
```
[TRANSLATION] ‚ùå Cache MISS - translating (en ‚Üí es)...
[TRANSLATION] ‚úÖ Translated in XXXms (total: XXXms)
```

**‚ùå Si ves:**
```
[TRANSLATION] Cache HIT
```
‚Üí Significa que no se limpi√≥ bien. Repetir paso 2.1.

---

**2.4. Verificar que se guard√≥ en base de datos**

En Supabase SQL Editor:
```sql
-- Ver traducciones guardadas
SELECT 
  source_lang,
  target_lang,
  LEFT(source_text, 50) as source_preview,
  LEFT(translated_text, 50) as translated_preview,
  usage_count,
  created_at
FROM translation_cache
ORDER BY created_at DESC
LIMIT 5;
```

**‚úÖ Resultado esperado:** Debe aparecer 1 fila:
```
source_lang: en
target_lang: es
source_preview: What is the WiFi password?
translated_preview: ¬øCu√°l es la contrase√±a del WiFi?
usage_count: 1
```

---

## üß™ TEST 3: Cache HIT - Traducci√≥n Repetida (10 min)

### Objetivo
Verificar que la segunda vez que se traduce lo mismo, usa la cach√©.

### Pasos

**3.1. Recargar la p√°gina**

1. Recargar staging (F5)
2. Escribir **exactamente el mismo mensaje**: `"What is the WiFi password?"`
3. Enviar

**‚úÖ Debe responder en ingl√©s (m√°s r√°pido que antes)**

---

**3.2. Revisar logs de Vercel**

**‚úÖ Resultado esperado:**
```
[TRANSLATION] üíæ L2 Cache HIT (database): XXms
```

**‚ùå Si ves "Cache MISS" otra vez:**
‚Üí La cach√© no est√° funcionando. Avisar a Antigravity.

---

**3.3. Verificar que el contador aument√≥**

En Supabase SQL Editor:
```sql
SELECT 
  source_text,
  usage_count,
  last_used_at
FROM translation_cache
WHERE source_text ILIKE '%wifi password%'
ORDER BY last_used_at DESC;
```

**‚úÖ Resultado esperado:**
```
usage_count: 2  (aument√≥ de 1 a 2)
last_used_at: [timestamp reciente]
```

---

## üß™ TEST 4: M√∫ltiples Idiomas (20 min)

### Objetivo
Probar que funciona con franc√©s, alem√°n, italiano.

### Pasos

**4.1. Probar en franc√©s**

1. Cambiar idioma a **Fran√ßais**
2. Escribir: `"Comment utiliser le four?"`
3. Enviar

**‚úÖ Debe responder en franc√©s**

Verificar en logs:
```
[TRANSLATION] Cache MISS (primera vez)
```

---

**4.2. Repetir en franc√©s**

1. Recargar p√°gina
2. Escribir de nuevo: `"Comment utiliser le four?"`
3. Enviar

**‚úÖ Logs deben decir:**
```
[TRANSLATION] Cache HIT
```

---

**4.3. Probar en alem√°n**

1. Cambiar idioma a **Deutsch**
2. Escribir: `"Wie benutze ich den Ofen?"`
3. Enviar

**‚úÖ Debe responder en alem√°n**

---

**4.4. Verificar base de datos**

```sql
-- Ver todas las traducciones por idioma
SELECT 
  source_lang,
  COUNT(*) as total_translations,
  SUM(usage_count) as total_usage
FROM translation_cache
GROUP BY source_lang
ORDER BY total_usage DESC;
```

**‚úÖ Resultado esperado:**
```
en  | 1 | 2  (ingl√©s, usado 2 veces)
fr  | 1 | 1  (franc√©s, usado 1 vez)
de  | 1 | 1  (alem√°n, usado 1 vez)
```

---

## üß™ TEST 5: Streaming de Respuestas Largas (15 min)

### Objetivo
Verificar que respuestas largas se traducen correctamente en chunks.

### Pasos

**5.1. Hacer pregunta que genera respuesta larga**

En ingl√©s, escribir:
```
"Can you list all the programs the oven has and explain what each one does?"
```

**‚úÖ La respuesta debe:**
- Aparecer gradualmente (streaming)
- Estar completamente en ingl√©s
- No tener cortes raros mid-palabra

**‚ùå Se√±ales de problema:**
- Respuesta aparece de golpe (no streaming)
- Mitad ingl√©s, mitad espa√±ol
- Palabras cortadas: "The pr-ogram is for bak-ing"

---

**5.2. Verificar chunks en logs**

```
[TRANSLATION] Cache HIT (m√∫ltiples l√≠neas, una por chunk)
```

**‚úÖ Debe haber varios cache hits (uno por chunk de ~150 caracteres)**

---

## üß™ TEST 6: C√≥digo de Error (15 min)

### Objetivo
Verificar que c√≥digos de error se detectan y traducen correctamente.

### Pasos

**6.1. En espa√±ol (baseline)**

1. Cambiar idioma a **Espa√±ol**
2. Escribir: `"El horno marca error E15"`
3. Enviar

**‚úÖ Debe responder explicando el error E15 en espa√±ol**

---

**6.2. En ingl√©s (traducci√≥n)**

1. Cambiar idioma a **English**
2. Escribir: `"The oven shows error E15"`
3. Enviar

**‚úÖ Debe:**
- Detectar "E15" correctamente
- Responder en ingl√©s
- Dar la misma soluci√≥n que en espa√±ol (traducida)

---

**6.3. Verificar en logs**

```
[CHAT-DEBUG] Detection: { chatStrategy: 'error_code', detectedErrorCode: 'E15' }
[TRANSLATION] RAG Query Translation
```

**‚úÖ La query RAG debe traducirse antes de buscar en la base de datos**

---

## üß™ TEST 7: Emergencias (10 min)

### Objetivo
Verificar que emergencias se manejan en cualquier idioma.

### Pasos

**7.1. En ingl√©s**

Escribir: `"The oven is smoking!"`

**‚úÖ Debe responder:**
- En ingl√©s
- Con tono de urgencia: "‚ö†Ô∏è For safety, turn off/unplug..."
- Dar contacto de soporte

---

**7.2. En franc√©s**

Escribir: `"Le four fume!"`

**‚úÖ Debe responder:**
- En franc√©s
- Mismo formato de emergencia

---

## üß™ TEST 8: Performance y Latencia (20 min)

### Objetivo
Medir que las traducciones con cach√© son r√°pidas.

### Pasos

**8.1. Medir cache MISS (primera vez)**

1. Limpiar cach√©: `DELETE FROM translation_cache;`
2. Escribir mensaje nuevo: `"Where is the parking?"`
3. **Medir tiempo** (cron√≥metro desde ENTER hasta primera letra de respuesta)

**‚úÖ Resultado esperado:** 1-3 segundos

---

**8.2. Medir cache HIT (segunda vez)**

1. Recargar p√°gina
2. Escribir **mismo mensaje**: `"Where is the parking?"`
3. **Medir tiempo**

**‚úÖ Resultado esperado:** 0.5-1.5 segundos (mucho m√°s r√°pido)

**Mejora esperada:** Al menos 50% m√°s r√°pido

---

**8.3. Verificar en logs el tiempo exacto**

```
[TRANSLATION] Cache MISS: XXXms  (primera vez)
[TRANSLATION] Cache HIT: XXms    (segunda vez)
```

**‚úÖ El cache HIT debe ser <100ms**

---

## üß™ TEST 9: Estad√≠sticas de Cach√© (10 min)

### Objetivo
Verificar que las estad√≠sticas se generan correctamente.

### Pasos

**9.1. Ejecutar funci√≥n de stats**

En Supabase SQL Editor:
```sql
SELECT * FROM get_translation_cache_stats();
```

**‚úÖ Resultado esperado (ejemplo):**
```json
{
  "total_translations": 8,
  "total_usage": 15,
  "avg_translation_time_ms": 450.25,
  "top_source_lang": "en",
  "top_target_lang": "es",
  "cache_size_mb": 0.02
}
```

**‚ùå Si devuelve error:** La funci√≥n SQL no se cre√≥ bien.

---

**9.2. Probar API de admin (si existe)**

En navegador o Postman:
```
GET https://staging.tuapp.com/api/admin/translation-stats
Authorization: Bearer TU_ADMIN_API_KEY
```

**‚úÖ Debe devolver JSON con stats (igual que arriba)**

**‚ùå Si da 401:** Verificar que `ADMIN_API_KEY` est√° en variables de entorno.

---

## üß™ TEST 10: Edge Cases (30 min)

### Objetivo
Probar casos extremos que podr√≠an romper el sistema.

### Casos a probar:

**10.1. Texto muy largo**
```
Escribir 10+ l√≠neas de texto en ingl√©s
```
**‚úÖ Debe traducir completo sin errores**

---

**10.2. Caracteres especiales**
```
"What's the WiFi password? It's Andr√©'s apartment!"
```
**‚úÖ Debe manejar ap√≥strofes y acentos**

---

**10.3. Mezcla de idiomas**
```
"Hello, ¬ød√≥nde est√° el parking? Merci!"
```
**‚úÖ Debe detectar idioma principal (el del selector)**

---

**10.4. Emojis**
```
"WiFi password? üîêüì∂"
```
**‚úÖ Debe funcionar normalmente**

---

**10.5. Mismo idioma (bypass)**

1. Cambiar selector a **Espa√±ol**
2. Escribir en espa√±ol: `"¬øCu√°l es la clave WiFi?"`

**‚úÖ No debe traducir (es ‚Üí es)**

Verificar en logs:
```
NO debe aparecer [TRANSLATION]
```

---

## üß™ TEST 11: Limpieza de Cach√© (10 min)

### Objetivo
Verificar que la funci√≥n de limpieza funciona.

### Pasos

**11.1. Llenar cach√© con traducciones**

1. Enviar 10-15 mensajes diferentes en varios idiomas
2. Verificar que se guardaron:

```sql
SELECT COUNT(*) FROM translation_cache;
-- Debe mostrar ~10-15
```

---

**11.2. Ejecutar limpieza**

```sql
SELECT * FROM cleanup_translation_cache();
```

**‚úÖ Resultado esperado:**
```
deleted_count: 0  (si hay <10,000 traducciones, no borra nada)
```

**Nota:** Esta funci√≥n solo borra si hay >10,000 entradas, as√≠ que en testing siempre devolver√° 0.

---

## üß™ TEST 12: Load Test B√°sico (20 min)

### Objetivo
Verificar que soporta m√∫ltiples peticiones simult√°neas.

### Pasos

**12.1. Abrir 5 pesta√±as**

1. Abrir staging en 5 pesta√±as del navegador
2. En cada una, cambiar a un idioma diferente:
   - Pesta√±a 1: Ingl√©s
   - Pesta√±a 2: Franc√©s  
   - Pesta√±a 3: Alem√°n
   - Pesta√±a 4: Italiano
   - Pesta√±a 5: Espa√±ol

---

**12.2. Enviar mensajes simult√°neos**

En cada pesta√±a, escribir y enviar casi al mismo tiempo:
```
"What is the checkout time?"
"Quelle est l'heure de d√©part?"
"Wann ist die Abreisezeit?"
"Qual √® l'orario di check-out?"
"¬øA qu√© hora es el checkout?"
```

**‚úÖ Todas deben responder:**
- En su idioma correcto
- Sin errores 500
- En <5 segundos

---

**12.3. Verificar m√©tricas**

```sql
SELECT 
  DATE_TRUNC('minute', created_at) as minute,
  COUNT(*) as translations_per_minute
FROM translation_metrics
WHERE created_at > NOW() - INTERVAL '10 minutes'
GROUP BY minute
ORDER BY minute DESC;
```

**‚úÖ Debe mostrar spike de 5 traducciones en el mismo minuto**

---

## ‚úÖ CHECKLIST FINAL ANTES DE PRODUCCI√ìN

Todos estos deben estar ‚úÖ:

### Base de Datos
- [ ] Tablas `translation_cache` y `translation_metrics` existen
- [ ] √çndices creados correctamente
- [ ] Funciones SQL funcionan sin errores

### Funcionalidad Core
- [ ] Cache MISS funciona (primera traducci√≥n)
- [ ] Cache HIT funciona (traducciones repetidas)
- [ ] Todos los idiomas soportados funcionan (en, fr, de, it, pt)
- [ ] Contador `usage_count` incrementa correctamente

### Streaming y UX
- [ ] Respuestas largas se muestran progresivamente
- [ ] No hay cortes mid-palabra
- [ ] Respuestas est√°n 100% en el idioma seleccionado

### Edge Cases
- [ ] Textos largos (500+ chars) funcionan
- [ ] Caracteres especiales y emojis funcionan
- [ ] C√≥digos de error se detectan en todos los idiomas
- [ ] Emergencias se manejan correctamente

### Performance
- [ ] Cache HIT es al menos 50% m√°s r√°pido que MISS
- [ ] Cache HIT toma <150ms seg√∫n logs
- [ ] Soporta 5+ requests simult√°neas sin errores

### M√©tricas y Admin
- [ ] Estad√≠sticas SQL devuelven datos correctos
- [ ] API de admin funciona (si existe)
- [ ] Logs muestran informaci√≥n √∫til

---

## üö® CRITERIOS DE BLOQUEO (NO PASAR A PRODUCCI√ìN SI)

‚ùå **Bloqueador 1:** Cache no funciona (siempre dice "MISS")
- **Impacto:** No hay beneficio, solo a√±ade latencia
- **Acci√≥n:** Antigravity debe debuggear

‚ùå **Bloqueador 2:** Respuestas en idioma incorrecto
- **Impacto:** Experiencia del hu√©sped rota
- **Acci√≥n:** Revisar l√≥gica de streaming con traducci√≥n

‚ùå **Bloqueador 3:** Errores 500 en producci√≥n
- **Impacto:** Chat no funciona
- **Acci√≥n:** Revisar logs, probablemente Edge Runtime issue

‚ùå **Bloqueador 4:** Respuestas extremadamente lentas (>5s)
- **Impacto:** Hu√©spedes abandonan el chat
- **Acci√≥n:** Verificar que fire-and-forget est√° bien implementado

---

## üìä REPORTE DE TESTING

Despu√©s de completar todos los tests, llena este reporte:

```
========================================
REPORTE DE TESTING - TRADUCCI√ìN CACH√â
========================================

Fecha: _______________
Tester: _______________
Staging URL: _______________

RESULTADOS:
-----------
‚úÖ Tests pasados: ____ / 12
‚ùå Tests fallidos: ____
‚ö†Ô∏è  Warnings encontrados: ____

BLOCKERS:
---------
[ ] Ninguno - OK para producci√≥n
[ ] Bloqueador 1: Cache no funciona
[ ] Bloqueador 2: Idioma incorrecto
[ ] Bloqueador 3: Errores 500
[ ] Bloqueador 4: Muy lento

NOTAS ADICIONALES:
------------------
(Describe cualquier comportamiento raro que notaste)




DECISI√ìN FINAL:
---------------
[ ] ‚úÖ APROBAR para producci√≥n
[ ] ‚ùå RECHAZAR - necesita correcciones

Firma: _______________
```

---

## üí° TIPS PARA TESTING EFICIENTE

1. **Haz los tests en orden** - est√°n ordenados de simple a complejo
2. **Si falla un test temprano**, para ah√≠ y reporta a Antigravity
3. **Toma screenshots** de comportamientos raros
4. **Copia/pega los logs** cuando veas errores
5. **No pases a producci√≥n con blockers** - mejor esperar 1 d√≠a m√°s

---

## üÜò QU√â HACER SI ENCUENTRAS UN BUG

1. **Anota:**
   - Qu√© test estabas haciendo
   - Qu√© pasos seguiste
   - Qu√© viste (screenshot)
   - Qu√© esperabas ver

2. **Copia logs:**
   - De Vercel (√∫ltimas 50 l√≠neas)
   - De Supabase (si hay error SQL)

3. **Reporta a Antigravity:**
   ```
   Bug en TEST X:
   - Pasos: [pega pasos del test]
   - Resultado: [lo que viste]
   - Esperado: [lo que deb√≠a pasar]
   - Logs: [pega logs]
   - Screenshot: [adjunta]
   ```

4. **Marca ese test como ‚ùå** en tu checklist

5. **Contin√∫a con otros tests** (no bloques por 1 fallo)

---

## ‚úÖ CUANDO TODO PASE

**Env√≠a a Antigravity:**
```
‚úÖ Testing completo - OK para producci√≥n

Tests ejecutados: 12/12 ‚úÖ
Blockers: 0
Warnings: [lista si hay]

Performance observada:
- Cache MISS: ~XXX ms
- Cache HIT: ~XX ms  
- Mejora: XX%

Listo para deploy a producci√≥n.
```

¬°Y listo! üéâ